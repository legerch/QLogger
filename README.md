**QLogger** is made to be compatible with [_Qt framework logs_][doc-qt-log-module] management, this library provide an easy (and _thread-safe_) way to use _log file rotation_ behaviour.  

**Table of contents:**
- [1. Requirements](#1-requirements)
- [2. How to build](#2-how-to-build)
- [3. How to use](#3-how-to-use)
  - [3.1. Initialization](#31-initialization)
  - [3.2. Desinitialization](#32-desinitialization)
  - [3.3. Log format](#33-log-format)
- [4. Documentation](#4-documentation)
- [5. Library details](#5-library-details)
  - [5.1. Why another log library ?](#51-why-another-log-library-)
  - [5.2. Implementation](#52-implementation)
- [6. License](#6-license)
- [7. Ressources](#7-ressources)

# 1. Requirements

- **C++11** compiler (see [implementation section][anchor-implementation] for more details)

# 2. How to build

This library can be use as an embedded library in a subdirectory of your project (like a git submodule for example):
1. In the **root** CMakeLists, add instructions:
```cmake
add_subdirectory(qlogger) # Or if library is put in a folder "dependencies" : add_subdirectory(dependencies/qlogger)
```

1. In the **application** CMakeLists, add instructions :
```cmake
# Link QLogger library
target_link_libraries(${PROJECT_NAME} PRIVATE qlogger)
```

# 3. How to use
## 3.1. Initialization
This library only have to be initialized in the `main` method of the application, then all call to log Qt logs methods (`qDebug()`, `qInfo()`, `qWarning()`, etc...) of the application and used libraries will be redirected to _QLogger_. Below, a simple example:
```cpp
#include "qlogger/qloghandler.h"

int main(int argc, char **argv)
{
    /* Set logs */
    QLogger::QLogHandler::instance().init("log.txt", 3, 1024 * 1024 * 5, true);

    /* Manage application properties */
    QApplication app(argc, argv);
    ...

    return app.exec();
}
```
> This will configure **QLogger** for:
> - Number of logs files limited to **3**
> - Log file max size is **5 megabytes (5Mb)** (_1 Kb = 1024 bytes_, _1Mb = 1024 * 1024 bytes_)
> - Use `log.txt` as main file (once rotated, generated files will be: `log1.txt` and `log2.txt`)
> - All debug messages will also be redirected to console (useful during development phase)

## 3.2. Desinitialization

**QLogger** library will properly destruct (and close) all used ressources automatically when application is closed. But if user need to quit **QLogger** manually, just use:
```cpp
QLogger::QLogHandler::instance().desinit();
```

In this case, default Qt logger will be restablished. User can still use his own log behaviour with [`qInstallMessageHandler()`][doc-qt-log-install-custom] method (**QLogger** must have been desinitialize !)


## 3.3. Log format

Log message will be formatted as below, depending of type of build:
- **Release:** `[utc-date][type-log] log-msg`
- **Debug:** `[utc-date][type-log] log-msg (cpp-file:cpp-line, cpp-function)`

If source file informations must appears on logs even on **release** mode, please use the associated macro in your main _CMakefile_: [`QT_MESSAGELOGCONTEXT`][doc-qt-log-context].

# 4. Documentation

All methods has been documented with [Doxygen][doc-doxygen] utility, documentation can be generated by using:
```shell
# Run documentation generation
doxygen ./Doxyfile

# Under Windows OS, maybe doxygen is not added to the $PATH
"C:\Program Files\doxygen\bin\doxygen.exe" ./Doxyfile
```
> **Note:** You can also load the _Doxyfile_ into _Doxywizard_ (Doxygen GUI) and run generation.

# 5. Library details
## 5.1. Why another log library ?

We already have many good C++ logs libraries outside, so why to create a new one ? Since many of my custom application are built with Qt framework, I thought that having Qt framework as a dependency was already enough and didnt' want to use another just for logging. Besides, alternatives C++ logs libraries doesn't behave properly when used inside a library (`.dll` under **Windows**, `.so` under **Linux**) but Qt log framework allow such usage.  
Only missing feature: _file rotation with thread-safety_.  

Qt log module allow to easily add our custom log behaviour throught [`qInstallMessageHandler()`][doc-qt-log-install-custom]. This library is just build around that extension feature.

## 5.2. Implementation

This library use the [singleton pattern][doc-pattern-singleton] to manage **QLogger** instance. This singleton was implemented using [Meyer's Singleton][doc-singleton-meyer-1] pattern, this implementation use static variable initialization to ensure thread-safety at initialization. This doesn't ensure your singleton to be thread-safe... only his _initialization_ and _desininitialization_ are !  
Note that (at least !) a **C++11** compiler is required (**C++11** added requirement for static variable initialization to be thread-safe).
> For more informations about **Meyer's Singleton**, see below:
> - [Stackexchange - Singleton class and correct way to access it in C++][doc-singleton-meyer-2]
> - [Stackoverflow - How is Meyers' implementation of a Singleton actually a Singleton][doc-singleton-meyer-3]

Then, library thread-safety is ensured by using a mutex whenever a log message is received (to prevent for thread-race issues when trying to write to log file for example).

# 6. License

This library is licensed under [MIT license][repo-license].

# 7. Ressources

- Qt ressources
  - [Qt logs module][doc-qt-log-module]
  - [Qt log custom handler][doc-qt-log-install-custom]
- Singleton pattern
  - [RefactoringGuru - Singleton pattern][doc-pattern-singleton]
  - [Meyerâ€™s Singleton][doc-singleton-meyer-1]
  - [Stackexchange - Singleton class and correct way to access it in C++][doc-singleton-meyer-2]
  - [Stackoverflow - How is Meyers' implementation of a Singleton actually a Singleton][doc-singleton-meyer-3]
- Documentation utility
  - [Doxygen][doc-doxygen]
- C++ logs libraries:
    - [sdplog][log-lib-sdplog]
    - [plog][log-lib-plog]
    - [glog][log-lib-glog]
    - [easyloggingcpp][log-lib-easyloggingcpp]
    - [log4cplus][log-lib-log4cplus]
    - [loguru][log-lib-loguru]

<!-- Anchors of this file -->
[anchor-implementation]: #52-implementation

<!-- Repository links -->
[repo-license]: LICENSE

<!-- External links -->
[doc-doxygen]: https://www.doxygen.nl/

[doc-qt-log-module]: https://doc.qt.io/qt-6/qtlogging.html
[doc-qt-log-install-custom]: https://doc.qt.io/qt-5/qtglobal.html#qInstallMessageHandler
[doc-qt-log-context]: https://doc.qt.io/qt-6/qmessagelogcontext.html

[doc-pattern-singleton]: https://refactoring.guru/design-patterns/singleton

[doc-singleton-meyer-1]: https://laristra.github.io/flecsi/src/developer-guide/patterns/meyers_singleton.html
[doc-singleton-meyer-2]: https://codereview.stackexchange.com/questions/197486/singleton-class-and-correct-way-to-access-it-in-c
[doc-singleton-meyer-3]: https://stackoverflow.com/questions/17712001/how-is-meyers-implementation-of-a-singleton-actually-a-singleton

[log-lib-sdplog]: https://github.com/gabime/spdlog
[log-lib-plog]: https://github.com/SergiusTheBest/plog
[log-lib-glog]: https://github.com/google/glog
[log-lib-easyloggingcpp]: https://github.com/abumq/easyloggingpp
[log-lib-log4cplus]: https://github.com/log4cplus/log4cplus
[log-lib-loguru]: https://github.com/emilk/loguru